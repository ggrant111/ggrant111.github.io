# Lead Generator

A modern tool for automotive sales teams to generate and track customer leads. This application allows sales team members to create customer lead data, select vehicles, and send leads directly to automotive CRM systems via email.

## Features

- Modern, intuitive UI built with React, Next.js, and Tailwind CSS
- Multi-step lead form with validation
- Automatic email sending (no more copy/paste)
- Lead tracking and statistics
- Random customer data generation
- Support for multiple dealership destinations
- Supabase database integration for tracking leads

## Getting Started

### Prerequisites

- Node.js 16+
- npm or yarn
- Supabase account (free tier available)
- Gmail account for sending emails

### Supabase Setup

1. Create a new project on [Supabase](https://supabase.com/)
2. Create a new table called `leads` with the following structure:

```sql
create table leads (
  id uuid not null default gen_random_uuid(),
  first_name text not null,
  last_name text not null,
  email text not null,
  phone text not null,
  address_street text not null,
  address_city text not null,
  address_state text not null,
  address_postal_code text not null,
  vehicle_year text,
  vehicle_make text,
  vehicle_model text,
  vehicle_vin text,
  vehicle_stock text,
  vehicle_trim text,
  vehicle_transmission text,
  comment text not null,
  destination text not null,
  sent_by text not null,
  sent_at timestamp with time zone not null default now(),
  success boolean not null default true,
  primary key (id)
);
```

3. Get your Supabase URL and keys from the project settings page (API section)

### Salespeople Table

Create a new table named `salespeople` with the following columns:

- `id` (int8, primary key, auto-increment)
- `name` (varchar, not null)
- `created_at` (timestamp with time zone, default: now())

You can run this SQL in the Supabase SQL Editor:

```sql
CREATE TABLE salespeople (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create an index on the name column
CREATE INDEX idx_salespeople_name ON salespeople(name);
```

4. Set Row Level Security (RLS) policies to control access as needed.
5. Add your Supabase URL and anon key to the `.env.local` file:

```
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
```

### Installation

1. Clone the repository:

```bash
git clone <repository-url>
cd leadgen-next
```

2. Install dependencies:

```bash
npm install
```

3. Create a `.env.local` file in the root directory with the following variables:

```
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project-url.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-public-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Email Configuration for Gmail
EMAIL_USER=your-gmail-account@gmail.com
EMAIL_PASS=your-app-password
```

> **Note:** For Gmail, you need to use an App Password. See [Sign in with App Passwords](https://support.google.com/accounts/answer/185833) for instructions.

4. Start the development server:

```bash
npm run dev
```

### Production Deployment

1. Build the application:

```bash
npm run build
```

2. Start the production server:

```bash
npm start
```

## Usage

1. **Generate Lead**: Fill out the multi-step form with customer information, vehicle details, and select a destination.
2. **Track Leads**: View statistics on sent leads, filter by sales person, and see success/failure rates.

## Integration Options

This tool can send leads to the following CRM systems:

- Excellence Motors (excellencemotors@eleadtrack.net)
- Universal Motors (excellencegm@eleadtrack.net)
- Excellence Ford (vexcellenceford@demosite.forddirectcrmpro.com)

## License

This project is licensed under the MIT License.

## Troubleshooting

### Gmail Authentication Issues

If you encounter authentication errors with Gmail:

1. Make sure you're using an App Password, not your regular Gmail password
2. Create an App Password at https://myaccount.google.com/security
3. Select "App passwords" under the "Signing in to Google" section
4. Generate a new app password for "Mail" and "Other (Custom name)" - you can name it "Lead Generator"
5. Copy the 16-character password (without spaces) into your .env.local file:
   ```
   EMAIL_USER=your-gmail@gmail.com
   EMAIL_PASS=your16characterapppassword
   ```
6. Restart your development server

### Running the App

Make sure you're in the correct directory when running commands:

```bash
# Navigate to the project directory first
cd leadgen-next

# Then run the development server
npm run dev

# Or build and start the production version
npm run build
npm start
```

### Linter Errors

If you encounter linter errors:

1. Run the linter to see all errors:

   ```bash
   npm run lint
   ```

2. Type checking errors can be caught with:
   ```bash
   npm run type-check
   ```

# Push Notifications Setup

This project includes push notification support for real-time lead submission notifications. Here's how to set it up:

## 1. Generate VAPID Keys

Run the following command to generate VAPID keys for web push notifications:

```bash
npm run generate-vapid-keys
```

This will output a public and private key. Add these to your `.env.local` file:

```
NEXT_PUBLIC_VAPID_PUBLIC_KEY=your-public-key
VAPID_PRIVATE_KEY=your-private-key
VAPID_SUBJECT=mailto:your-email@example.com
```

## 2. Set Up Supabase Database

The project includes a migration file for creating the push subscriptions table. Run this migration in your Supabase project:

1. Go to your Supabase project dashboard
2. Navigate to the SQL editor
3. Copy and paste the contents of `supabase/migrations/20240328000000_create_push_subscriptions.sql`
4. Run the SQL

## 3. Service Worker

The service worker is automatically registered when the application starts. It's located at `public/sw.js` and handles:

- Push notification reception
- Notification display
- Click handling for notifications

## 4. Usage

The `NotificationPermission` component can be added to any page where you want to allow users to enable notifications:

```tsx
import { NotificationPermission } from "@/components/NotificationPermission";

// In your component:
<NotificationPermission userId={currentUser.id} />;
```

## 5. Sending Notifications

When a new lead is submitted, the system will automatically:

1. Look up the salesperson's push subscriptions
2. Send a push notification to all their registered devices
3. Include the lead details and demo environment in the notification

## Browser Support

Push notifications are supported in:

- Chrome (desktop and mobile)
- Firefox (desktop and mobile)
- Edge (desktop and mobile)
- Opera (desktop and mobile)
- Safari (desktop and mobile)

## Security

- Push subscriptions are stored securely in Supabase
- Row Level Security ensures users can only access their own subscriptions
- VAPID keys are used to authenticate push notification requests
- Invalid subscriptions are automatically cleaned up

## Troubleshooting

If notifications aren't working:

1. Check the browser console for errors
2. Verify that the service worker is registered (check Application tab in DevTools)
3. Ensure VAPID keys are correctly set in environment variables
4. Check that the user has granted notification permissions
5. Verify that the push subscription is stored in Supabase
